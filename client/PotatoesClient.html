<!DOCTYPE html>
<link rel="stylesheet" href="mypotatostyle.css">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div id="potatoArea">
        <img src="Potato.png" id="potatoImg">
    </div>
    <div class="insertData">
        <input id="newBag" type="text" class="form">
        <button type="button" id="addBag">Create bag</button>
        <button type="button" id="bag">Refresh bag</button>
        <form>
            <label> Insert your potato</label>
            <br>
            <input type="text" class='form' id="potatoName">
            <br>
            <label>Insert the quantity</label>
            <br>
            <input type="number" min="0" class='form' id="qty">
        </form>
    </div>
    <div class=" insertData">
        <button type="button" id="insert">Add potatoes</button>
        <button type="button" id="remove">Remove potatoes</button>

    </div>
    <div id="bagArea">

    </div>
    <script>
        const serverLink = 'http://localhost:8080'

        document.getElementById("insert").addEventListener('click', handleInsert)

        document.getElementById("remove").addEventListener('click', handleRemove)
        document.getElementById('addBag').addEventListener('click', handleCreateNewBag)
        document.getElementById('bag').addEventListener('click', handleRefreshBags)
        let potatoName = document.getElementById('potatoName')
        let qty_input = document.getElementById('qty')
       
        let bagListTextArea = document.getElementById('bagArea')

//handle and request of print all the bags
        function handleRefreshBags() {

            getBagList().then((bags) => {
                let bagsList = bags;
                bagListTextArea.innerText = bagsList.map((value, index, array) => value['name'])
                console.log(bagsList)
            })
        }

        async function getBagList() {
            const response = await fetch(serverLink + '/bags');
            const bags = await response.json()
            return bags
        }



// handle functiona and post request of adding a new bag
         function handleCreateNewBag() {
            let bag_name = document.getElementById('newBag').value
            postNewBag(bag_name).then((newBag)=>{console.log(newBag)})
            
        }
        async function postNewBag(bag_name){
            const response = await fetch(serverLink + '/bags', {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ bag_name: bag_name })
            }
            )
            const newBag= await response.json
        }

//handle function and request of adding a new potato
        function handleInsert() {
            bag_name='Bag1'
            addPotato(bag_name).then((potato) => {
                console.log(potato)
            })

        }

        async function addPotato(bag_name) {
            let potato_name = potatoName.value
            let qty = qty_input.value
            const response = await fetch(serverLink + '/bags/' + bag_name + '/potato_list/' + potato_name, {
                method: 'PUT',
                headers: {
                    "Content-Type": "application/json"
                }
                ,
                body: JSON.stringify({ qty: qty })
            }
            )
            const potato = await response.json
            return potato
        }


        //handle functiona d request o remove a certain quantity of a potato

        function handleRemove(){
            bag_name='Bag1'
            removePotato(bag_name).then((potato) => {
                console.log(potato)
            })

        }

        async function removePotato(bag_name){
            let potato_name = potatoName.value
            let qty = '-'+qty_input.value
            const response = await fetch(serverLink + '/bags/' + bag_name + '/potato_list/' + potato_name, {
                method: 'PUT',
                headers: {
                    "Content-Type": "application/json"
                }
                ,
                body: JSON.stringify({ qty: qty })
            }
            )
            const potato = await response.json
            return potato
        }
    </script>
</body>